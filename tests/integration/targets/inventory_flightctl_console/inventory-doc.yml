- name: Test that flightctl inventory plugin is described correctly in ansible-doc
  hosts: localhost
  gather_facts: false
  vars:
    required_phrases:
      - "FLIGHTCTL.CORE.FLIGHTCTL"
      - "Returns Ansible inventory using Flight Control as source"
      - "ADDED IN: version"
      - "OPTIONS (= is mandatory):"
      - "NAME: flightctl"
  tasks:
    - name: Run ansible-doc to get plugin help text
      ansible.builtin.command: ansible-doc -t inventory flightctl.core.flightctl
      register: doc_output
      changed_when: false

    - name: Assert all required phrases are present in ansible-doc output
      ansible.builtin.assert:
        that: >
          {{ required_phrases | map('in', doc_output.stdout) | list | min }}
        fail_msg: "One or more expected phrases are missing in ansible-doc output"

    - name: Show ansible-doc output for debug
      ansible.builtin.debug:
        var: doc_output.stdout
